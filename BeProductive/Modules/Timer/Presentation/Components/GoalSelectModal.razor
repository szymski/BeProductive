@inject GoalService GoalService

@* TODO: Better scrollbar *@

<Modal Title="Select goal"
       OnCancel="() => _visible = false"
       Visible="@_visible"
       Footer="RenderFooter()"
       Centered
       BodyStyle="padding: 0">
    <AntList DataSource="@_goals" Style="overflow: auto; height: 50vh">
        <ChildContent Context="goal">
            @if (goal is null)
            {
                <ListItem Class="goal-item" OnClick="() => SelectGoal(null)">
                    <Space Style="margin: 0 1rem; width: 100%; height: 32px">
                        <SpaceItem>
                        </SpaceItem>
                        <SpaceItem Style="width: 100%; text-align: center">
                            <Text Strong Style="font-size: 16px">
                                None
                            </Text>
                        </SpaceItem>
                    </Space>
                </ListItem>
            }
            else
            {
                <ListItem Class="goal-item" OnClick="() => SelectGoal(goal)">
                    <Space Style="margin: 0 1rem; width: 100%; height: 32px">
                        <SpaceItem>
                            @if (string.IsNullOrEmpty(goal.Icon))
                            {

                                <Avatar Size="large" Style=@($"background: {@goal.Color}")/>
                            }
                            else
                            {

                                <Avatar Size="large"
                                        Style=@($"color: {@goal.Color}; background: transparent; font-size: 32px")
                                        Icon="@goal.Icon"/>

                            }
                        </SpaceItem>
                        <SpaceItem Style="width: 100%; text-align: center">
                            <Text Strong Style="font-size: 16px">
                                @goal.Name
                            </Text>
                        </SpaceItem>
                    </Space>
                </ListItem>
            }
        </ChildContent>
    </AntList>
</Modal>

<style>
    .goal-item {
        cursor: pointer;
    }
    
    .goal-item:hover {
        background: rgba(0, 0, 0, 0.1);
    }
    
    [data-theme="dark"] .goal-item:hover {
        /* TODO */
        background: rgba(255, 255, 255, 0.2);
    }
</style>

@code {

    private RenderFragment RenderFooter()
        => @<Button Type="@ButtonType.Default" OnClick=@(() => _visible = false)>Cancel</Button>;

}

@code {

    private bool _visible = true;

    private List<Goal?> _goals = new();

    [Parameter]
    public EventCallback<Goal?> OnGoalSelect { get; set; }

    protected override async Task OnInitializedAsync()
    {
        _goals = (await GoalService.GetGoals())!;
        _goals.Insert(0, null!);
    }

    private async Task SelectGoal(Goal goal)
    {
        _visible = false;
        await OnGoalSelect.InvokeAsync(goal);
    }

    public void Open()
    {
        _visible = true;
        StateHasChanged();
    }

}