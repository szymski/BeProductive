@implements IDisposable

@if (!string.IsNullOrEmpty(_title))
{
    <PageHeader Class=@($"page-header {(string.IsNullOrEmpty(Layout.Title) ? "hidden" : "")}") Title="@_title" Subtitle="@_subtitle">
        <TitleTemplate>
            <Button
                Class="menu-button"
                Type="@ButtonType.Text"
                Size="@ButtonSize.Large"
                Shape="@ButtonShape.Circle"
                Icon="@IconType.Outline.MenuUnfold"
                OnClick="OnMenuClick"/>
            @_title
        </TitleTemplate>
    </PageHeader>
    <PageTitle>@Layout.Title - beProductive</PageTitle>
}
else
{
    <PageTitle>beProductive</PageTitle>
}


@* TODO: Separate file *@
<style>
    .page-header {
        margin-top: 0;
        transition: margin-top 0.3s ease-in-out;
    }

    .page-header.hidden {
        margin-top: -72px;
    }
    
    .menu-button {
        display: none;
    }
    
    @@media(max-width: 768px) {
        .menu-button {
            display: inline-block;
        }
        
        .page-header {
            padding-left: 16px;
            padding-right: 16px;
        }
    }
</style>

@code {

    private string _title = "";
    private string _subtitle = "";

    [CascadingParameter]
    public AuthenticationState AuthenticationState { get; set; }

    [Parameter]
    public EventCallback OnMenuClicked { get; set; }
    
    protected override void OnInitialized()
    {
        Layout.OnUpdate += OnUpdate;
        NavigationManager.LocationChanged += OnNavigation;
    }

    private void OnNavigation(object? sender, LocationChangedEventArgs e)
    {
    // Layout.Reset();
    // InvokeAsync(StateHasChanged);
    }

    private void OnUpdate()
    {
        if (!string.IsNullOrEmpty(Layout.Title))
        {
            _title = Layout.Title ?? "";
            _subtitle = Layout.Subtitle ?? "";
        }
        InvokeAsync(StateHasChanged);
    }

    private Task OnMenuClick()
    {
        return OnMenuClicked.InvokeAsync();
    }

    public void Dispose()
    {
        Layout.OnUpdate -= OnUpdate;
        NavigationManager.LocationChanged -= OnNavigation;
    }

}