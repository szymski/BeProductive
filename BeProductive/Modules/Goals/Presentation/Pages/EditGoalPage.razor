@page "/goal/{GoalId:int}/edit"
@using BeProductive.Modules.Goals.Presentation.Models

<GoalForm
    Type="GoalForm.GoalFormType.Edit"
    GoalName="@_goal.Name"
    Value="@_model"
    OnFinished="@OnFinished"
    OnDeleted="OnDeleted"
    />

@code {

    [Parameter]
    public int GoalId { get; set; }

    private Goal? _goal;

    private GoalModel _model = new();

    protected override async Task OnParametersSetAsync()
    {
        _goal = await GoalService.GetGoal(GoalId);
        _model = GoalModel.FromGoal(_goal);
    }

    private async Task OnFinished()
    {
        var goal = _model.ApplyToGoal(_goal);
        await GoalService.SaveGoal(goal);
        
        NotificationService.Success("The goal has been updated");

        NavigationManager.NavigateTo(GoalListPage.GetUrlWithSelectedGoal(goal));
    }

    private async Task OnDeleted()
    {
        await GoalService.DeleteGoal(_goal);

        NotificationService.Success("The goal has been deleted");
        
        NavigationManager.NavigateTo(GoalListPage.Url);
    }

}